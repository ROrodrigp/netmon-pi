# =============================================================================
# WORKFLOW: Validar datos del escaneo
# =============================================================================
# Este workflow se ejecuta cada vez que la Raspberry Pi hace push de un nuevo
# escaneo. Valida que el JSON tenga la estructura correcta y muestra un resumen.
# =============================================================================

name: Validate Scan Data

# -----------------------------------------------------------------------------
# ON: ¿Cuándo se ejecuta este workflow?
# -----------------------------------------------------------------------------
# "push" = cuando alguien hace push al repositorio
# "paths" = SOLO si los archivos modificados coinciden con este patrón
#
# Esto significa: "Ejecuta este workflow cuando haya un push que modifique
# cualquier archivo dentro de la carpeta data/"
# -----------------------------------------------------------------------------
on:
  push:
    paths:
      - 'data/**'

# -----------------------------------------------------------------------------
# JOBS: ¿Qué trabajos ejecutar?
# -----------------------------------------------------------------------------
# Cada job corre en una máquina virtual independiente.
# Aquí solo tenemos un job llamado "validate".
# -----------------------------------------------------------------------------
jobs:
  validate:
    name: Validate JSON Structure

    # La VM donde correrá (Ubuntu Linux gratuito de GitHub)
    runs-on: ubuntu-latest

    # -------------------------------------------------------------------------
    # STEPS: Pasos secuenciales del job
    # -------------------------------------------------------------------------
    steps:
      # Paso 1: Descargar el código del repositorio a la VM
      - name: Checkout repository
        uses: actions/checkout@v4

      # Paso 2: Instalar Python (la VM tiene Python, pero esto garantiza la versión)
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      # Paso 3: Ejecutar script de validación
      # El script está en scripts/validate_scan.py
      # Si el JSON es inválido, el script retorna exit code 1 y el workflow falla
      - name: Validate scan results
        run: python scripts/validate_scan.py
